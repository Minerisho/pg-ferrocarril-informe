\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{icontec_style}[2025/10/26 v1.4 ICONTEC Arial (LuaLaTeX)]

% --- Márgenes ICONTEC aprox. ---
\RequirePackage[letterpaper,left=4cm,right=2cm,top=3cm,bottom=3cm]{geometry}

% --- Tipografías: Arial desde ./fonts (TTF) ---
% Compilar siempre con LuaLaTeX.
\RequirePackage{fontspec}

% Usa Arial como tipografía principal del documento
% (textos normales, títulos, etc.). Cargamos los archivos TTF explícitos.
\setmainfont[
  Path=fonts/,
  UprightFont    = ARIAL.ttf,
  BoldFont       = ARIALBD.ttf,
  ItalicFont     = ARIALI.ttf,
  BoldItalicFont = ARIALBI.ttf,
  Ligatures=TeX
]{Arial}

% También como sans para consistencia
\setsansfont[
  Path=fonts/,
  UprightFont    = ARIAL.ttf,
  BoldFont       = ARIALBD.ttf,
  ItalicFont     = ARIALI.ttf,
  BoldItalicFont = ARIALBI.ttf,,
  Ligatures=TeX
]{Arial}

% Hacemos que la familia por defecto sea sans (Arial)
\renewcommand{\familydefault}{\sfdefault}

% --- Matemáticas ---
% (Arial no tiene símbolos matemáticos; usamos newtxmath, estética sobria)
\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{newtxmath}

% --- Interlineado 1.5 ---
\RequirePackage{setspace}
\onehalfspacing

% --- Microtipografía ---
\RequirePackage{microtype}
\microtypesetup{protrusion=true,expansion=false}

% Para URLs largas sin overfull
\RequirePackage{xurl}

% --- Gráficos, tablas y listas ---
\RequirePackage{graphicx}
\RequirePackage{float}
\RequirePackage{booktabs}
\RequirePackage{enumitem}
\RequirePackage{xcolor}
\RequirePackage{array}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}} % centro H y V
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}m{#1}} % izquierda H, centro V
\RequirePackage{etoolbox}
\BeforeBeginEnvironment{longtable}{\begingroup}
\AfterEndEnvironment{longtable}{\endgroup}
\AtBeginEnvironment{longtable}{%
  \singlespacing                 % interlineado 1.0 dentro de la tabla
  %\renewcommand{\arraystretch}{1}% compacta altura de filas
  \setlength{\extrarowheight}{1pt}% puedes subir a 1pt si ves texto “apretado”
}
\AtBeginEnvironment{longtable}{\small ...} % o \footnotesize

% --- Formato de títulos ---
\RequirePackage{titlesec}

% Asegurar que se numeren hasta subsección (capítulo, sección, subsección)
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

% Capítulos: "1. Título"
\titleformat{\chapter}[hang]
  {\bfseries\Large}        % formato
  {\thechapter.}           % etiqueta (número + punto)
  {0.6em}                  % separación etiqueta–título
  {}

% Secciones: "1.1. Título"
\titleformat{\section}[hang]
  {\bfseries\normalsize}
  {\thesection.}
  {0.6em}
  {}

% Subsecciones: "1.1.1. Título"
\titleformat{\subsection}[hang]
  {\bfseries\normalsize}
  {\thesubsection.}
  {0.6em}
  {}


% --- Encabezados y pies ---
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}

% --- Figuras y tablas ---
\RequirePackage{caption}
\captionsetup{format=plain,labelfont=bf,labelsep=period,font=small}

% --- Código (ligero) ---
\RequirePackage{listings}
\lstset{
  basicstyle=\ttfamily\small,
  breaklines=true,
  frame=single,
  captionpos=b,
  tabsize=2
}

% --- Párrafo ---
\setlength{\parindent}{1.25cm}
\setlength{\parskip}{0pt}

% ================== Metadatos portada ==================
% Definiciones vacías
\providecommand{\universidad}{}
\providecommand{\facultad}{}
\providecommand{\programa}{}
\providecommand{\carrera}{} % <--- NUEVA VARIABLE
\providecommand{\titulo}{}
\providecommand{\autor}{}   
\providecommand{\asesor}{}  
\providecommand{\ciudad}{}
\providecommand{\anio}{}

% Interfaz por claves
\RequirePackage{xkeyval}
\makeatletter
\define@key{icontec}{universidad}{\renewcommand{\universidad}{#1}}
\define@key{icontec}{facultad}{\renewcommand{\facultad}{#1}}
\define@key{icontec}{programa}{\renewcommand{\programa}{#1}}
\define@key{icontec}{carrera}{\renewcommand{\carrera}{#1}} % <--- NUEVA CLAVE
\define@key{icontec}{titulo}{\renewcommand{\titulo}{#1}}
\define@key{icontec}{autor}{\renewcommand{\autor}{#1}}
\define@key{icontec}{autores}{\renewcommand{\autor}{#1}}   
\define@key{icontec}{director}{\renewcommand{\asesor}{#1}} 
\define@key{icontec}{asesor}{\renewcommand{\asesor}{#1}}
\define@key{icontec}{ciudad}{\renewcommand{\ciudad}{#1}}
\define@key{icontec}{anio}{\renewcommand{\anio}{#1}}
\newcommand{\icontecsetup}[1]{\setkeys{icontec}{#1}}
\makeatother

% --- Portada UIS Estilo Tesis ---
\providecommand{\maketitleicontec}{} 
\renewcommand{\maketitleicontec}{%
  \begin{titlepage}
    \centering
    % 1. TÍTULO DEL PROYECTO (ARRIBA)
    \vspace*{2cm}
    {\bfseries\Large \titulo\par}
    
    \vspace{3.5cm} % Espacio flexible
    
    % 2. AUTORES
    {\normalsize \autor\par}
    
    \vspace{3cm}
    
    % 3. LEYENDA DE GRADO
    {\normalsize Trabajo de Grado para Optar al Título de \carrera\par}
    
    \vspace{2.5cm}
    
    % 4. DIRECTOR
    {\normalsize Director\par}
    \vspace{0.3em}
    {\normalsize \asesor\par}
    
    \vfill % Empuja todo lo siguiente al final de la página
    
    % 5. BLOQUE INSTITUCIONAL (ABAJO)
    {\normalsize \universidad\par}
    {\normalsize \facultad\par}
    {\normalsize \programa\par}
    {\normalsize \carrera\par}
    \vspace{0.5cm}
    {\normalsize \ciudad\par}
    {\normalsize \anio\par}
  \end{titlepage}
  \clearpage
}
% --- Resumen / Abstract ---
\newenvironment{resumen}{%
  \chapter*{Resumen}\addcontentsline{toc}{chapter}{Resumen}%
}{}
\newenvironment{abstractES}{%
  \chapter*{Abstract}\addcontentsline{toc}{chapter}{Abstract}%
}{}
\newcommand{\keywords}[1]{\par\smallskip\noindent\textbf{Palabras clave:} #1}

% --- Utilidad para figuras centradas ---
\newcommand{\img}[4][0.9\linewidth]{%
  \begin{figure}[H]\centering
    \includegraphics[width=#1]{#2}
    \caption{#3}\label{#4}
  \end{figure}
}
