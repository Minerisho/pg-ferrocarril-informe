% !TeX root = ../main.tex

\chapter{Resultados}

En este capítulo se presentan los productos resultantes del proceso de desarrollo del prototipo del videojuego serio, abarcando desde la consolidación de los requerimientos y el diseño de la arquitectura, hasta la implementación del prototipo y el análisis de los datos obtenidos durante las pruebas individuales.

\section{Requerimientos}

Los artefactos presentados a continuación son el producto de un proceso de refinamiento continuo llevado a cabo durante las fases de inicio, elaboración e implementación. Tras múltiples ciclos de iteración y ajuste, se obtuvieron estos documentos que constituyen la versión final y consolidada de los requisitos funcionales y el análisis de riesgos que guiaron la implementación del videojuego serio.

\subsection{Matriz de Riesgos}

Para categorizar el estado de las amenazas identificadas, se aplicó la escala de medición definida en la etapa de planificación, en la cual el nivel de riesgo se determina por el producto del Impacto por la Probabilidad de ocurrencia (ver Figura \ref{fig:escala_riesgos}).
\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth]{figures/linea de impacto-probabilidad.png}
\caption{Escala de evaluación de riesgos utilizada durante el proyecto.}
\label{fig:escala_riesgos}
\end{figure}
 
La Tabla \ref{tab:matriz-riesgos-final} presenta la matriz de riesgos, donde las columnas representan lo siguiente:\\

\begin{enumerate}
  \item \textbf{Ref:} Identificador único alfanumérico asignado a cada riesgo para facilitar su seguimiento y referencia en el documento.
  \item \textbf{Descripción:} Detalle narrativo del evento incierto o problema técnico que podría afectar el desarrollo del proyecto.
  \item \textbf{Causa:} Factor, condición o decisión técnica que daría origen a la aparición del riesgo identificado.
  \item \textbf{Impacto:} Estimación de la magnitud de las consecuencias negativas sobre los objetivos del proyecto (rendimiento, tiempo o calidad) en una escala del 1 al 5.
  \item \textbf{Probabilidad:} Calificación numérica de la posibilidad de que el evento de riesgo ocurra durante el ciclo de vida del desarrollo, evaluada del 1 al 5.
  \item \textbf{Riesgo:} Valor cuantitativo obtenido del producto entre el Impacto y la Probabilidad, utilizado para priorizar la criticidad de la amenaza.
  \item \textbf{Plan de Acción:} Conjunto de estrategias, tareas o medidas de mitigación diseñadas para reducir o eliminar el efecto del riesgo en el sistema.
  \item \textbf{Estado:} Se definieron dos posibles estados para cada riesgo: \textit{Abierto}, que indica que el riesgo persiste y requiere de una resolución, y \textit{Cerrado}, que señala que el riesgo se ha materializado, ha sido mitigado exitosamente o se ha aceptado conscientemente que no se realizarán más acciones sobre él.
\end{enumerate}

Tras las iteraciones de desarrollo y las correcciones implementadas en la fase de implementación, todos los riesgos técnicos críticos fueron mitigados y cerrados exitosamente antes de la fase de evaluación.
\pagebreak
\begin{landscape}
\begin{longtable}{|c|L{5cm}|L{5cm}|c|c|c|L{5cm}|c|}
\caption{Matriz de riesgos del proyecto.}\label{tab:matriz-riesgos-final} \\
\hline
\multicolumn{1}{|c|}{\textbf{Ref}} &
\multicolumn{1}{c|}{\textbf{Descripción}} &
\multicolumn{1}{c|}{\textbf{Causa}} &
\multicolumn{1}{c|}{\textbf{Imp.}} &
\multicolumn{1}{c|}{\textbf{Prob.}} &
\multicolumn{1}{c|}{\textbf{Riesgo}} &
\multicolumn{1}{c|}{\textbf{Plan de acción}} &
\multicolumn{1}{c|}{\textbf{Estado}} \\
\hline
\endfirsthead

\hline
\multicolumn{1}{|c|}{\textbf{Ref}} &
\multicolumn{1}{c|}{\textbf{Descripción}} &
\multicolumn{1}{c|}{\textbf{Causa}} &
\multicolumn{1}{c|}{\textbf{Imp.}} &
\multicolumn{1}{c|}{\textbf{Prob.}} &
\multicolumn{1}{c|}{\textbf{Riesgo}} &
\multicolumn{1}{c|}{\textbf{Plan de acción}} &
\multicolumn{1}{c|}{\textbf{Estado}} \\
\hline
\endhead

\hline
\multicolumn{8}{r}{\textit{Continúa en la siguiente página}} \\
\endfoot

\hline
\endlastfoot

R3 & Vías poco naturales e inconexas & Uso de rectas para generar vías & 5 & 4 & 20 & Implementación de curvas Bézier y Splines. & Cerrado \\ \hline

R1 & El modelo del terreno está mal optimizado & Sobrecarga en memoria gráfica por modelo 3D denso & 4 & 4 & 16 & Uso de Terrenos nativos de Unity y carga por bloques (LOD). & Cerrado \\ \hline

R7 & Dificultad para representar hidrografía completa & Densidad excesiva de ríos en Colombia & 4 & 4 & 16 & Selección de ríos principales y lagos mayores únicamente. & Cerrado \\ \hline

R13 & Bajos FPS en equipos de gama baja & Desarrollo en equipos de gama alta & 5 & 3 & 15 & Optimización de draw calls y reducción de polígonos. & Cerrado \\ \hline

R8 & Las vías atraviesan montañas & Falta de interpolación de alturas & 3 & 4 & 12 & Generación automática de túneles al detectar colisión con terreno. & Cerrado \\ \hline

R2 & La cámara atraviesa el terreno & Falta de colisión en la cámara & 2 & 5 & 10 & Implementación de Clamping y colisionadores para la cámara. & Cerrado \\ \hline

R12 & Incompatibilidad de Shaders y URP & Configuración por defecto de Unity & 3 & 3 & 9 & Ajuste manual de materiales para el Universal Render Pipeline. & Cerrado \\ \hline

R9 & Estadísticas de locomotoras no leídas & Datos dispersos en hijos del GameObject & 4 & 2 & 8 & Unificar la lógica en el script controlador padre. & Cerrado \\ \hline

R4 & Terreno con parches o vacíos & DEM con datos erróneos & 2 & 3 & 6 & Corrección mediante algoritmos de suavizado. & Cerrado \\ \hline

R6 & Circuito cerrado no detectado & Spline no cerrado & 2 & 3 & 6 & Detección de proximidad de nodos inicial/final. & Cerrado \\ \hline

R10 & HUD no muestra vida tras cambio & Referencias perdidas al cambiar locomotora & 2 & 2 & 4 & Función para reiniciar estadísticas al instanciar. & Cerrado \\ \hline

R11 & Modelos 3D con escalas erróneas & Exportación incorrecta desde Blender & 1 & 3 & 3 & Aplicar escalas y rotaciones antes de exportar. & Cerrado \\ \hline

R5 & Textura de vías solapada & Vía al mismo nivel del suelo & 1 & 2 & 2 & Mover las vías generadas una pequeña distancia hacia arriba. & Cerrado \\ \hline

\end{longtable}
\end{landscape}
\subsection{Definición de Épicas e Historias de Usuario}

Con el objetivo de garantizar que el videojuego cumpliera con los lineamientos del Aprendizaje Basado en Juegos (GBL), el proceso de definición de requisitos comenzó con la elaboración de un conjunto preliminar de Historias de Usuario (HU). Este primer barrido buscó capturar todas las funcionalidades necesarias para cubrir tanto las mecánicas básicas como los objetivos del proyecto.\\

Posteriormente, para facilitar la gestión del desarrollo y la planificación de las iteraciones, estas historias de usuario fueron analizadas y agrupadas en categorías de alto nivel denominadas \textit{Épicas}. Esta organización permitió clasificar los requisitos de manera lógica según el subsistema o área funcional a la que pertenecían.

En la Tabla \ref{tab:epicas} se presentan las 8 épicas resultantes de esta categorización.

\begin{table}[H] 
\centering 
\caption{Listado de Épicas del proyecto.} \label{tab:epicas} 
\begin{tabular}{|c|l|} 
\hline 
\textbf{ID} & \textbf{Nombre de la Épica}\\ \hline 
1 & Selección de Nivel y Contratos \\ \hline 
2 & Interacción con el Mapa 3D \\ \hline 
3 & Sistema de Construcción de Vías \\ \hline 
4 & Gestión de Material Rodante \\ \hline 
5 & Motor de Simulación y Eventos \\ \hline 
6 & Sistema de Evaluación y Puntuación \\ \hline 
7 & Progresión y Rejugabilidad \\ \hline 
8 & Narrativa y Mentoría\\ \hline 
\end{tabular} 
\end{table}

La Tabla \ref{tab:HU-final} presenta el formato consolidado de las historias de usuario tras el proceso de refinamiento continuo tras cada iteración durante las fases del proyecto. Se define las columnas de la siguiente manera:\\

\begin{enumerate}
    \item \textbf{Épica:} Categoría funcional de alto nivel que agrupa un conjunto de historias de usuario relacionadas con un mismo módulo o subsistema del proyecto definidas anteriormente.
    \item \textbf{Código:} Referencia alfanumérica única asignada a cada requisito (ej. HU1) para facilitar su identificación y rastreabilidad técnica.
    \item \textbf{Historia de Usuario:} Descripción breve de una funcionalidad o necesidad del sistema, redactada desde la perspectiva del rol respectivo.
    \item \textbf{Prioridad:} Nivel de importancia asignado mediante el método MoSCoW, clasificando las tareas en: \textit{Must have} (M) como imprescindibles, \textit{Should have} (S) como importantes, \textit{Could have} (C) como deseables y \textit{Won't have} (W) para futuras implementaciones.
    \item \textbf{Complejidad:} Valor numérico en una escala de 1 a 5 que estima el grado de dificultad técnica y el esfuerzo requerido para la implementación de la funcionalidad.
\end{enumerate}
\pagebreak
\begin{landscape}
\begin{longtable}{|c|c|L{15cm}|c|c|}
\caption{Tabla final de historias de usuario implementadas.} \label{tab:HU-final} \\
\hline
\multicolumn{1}{|c|}{\textbf{ÉPICA}} &
\multicolumn{1}{c|}{\textbf{CÓDIGO}} &
\multicolumn{1}{c|}{\textbf{HISTORIA DE USUARIO}} &
\multicolumn{1}{c|}{\textbf{PRIO.}} &
\multicolumn{1}{c|}{\textbf{COMP.}} \\ \hline
\endfirsthead

\hline
\multicolumn{1}{|c|}{\textbf{ÉPICA}} &
\multicolumn{1}{c|}{\textbf{CÓDIGO}} &
\multicolumn{1}{c|}{\textbf{HISTORIA DE USUARIO}} &
\multicolumn{1}{c|}{\textbf{PRIO.}} &
\multicolumn{1}{c|}{\textbf{COMP.}} \\ \hline
\endhead

\hline
\multicolumn{5}{r}{\textit{Continúa en la siguiente página}} \\
\endfoot

\hline
\endlastfoot

1 & HU1  & Como jugador, quiero ver una pantalla de selección de niveles para elegir cuál jugar. & M & 2 \\ \hline
1 & HU2  & Como jugador, quiero que al empezar un nivel, se me presente una pantalla de contrato con presupuesto y objetivos. & M & 1 \\ \hline
2 & HU3  & Como jugador, quiero poder mover la cámara (panorámica) por el mapa para explorar el terreno. & M & 1 \\ \hline
2 & HU4  & Como jugador, quiero poder acercar y alejar la vista (zoom) para ver el mapa con diferentes niveles de detalle. & M & 1 \\ \hline
2 & HU5  & Como jugador, quiero ver las delimitaciones políticas y ríos en el mapa. & M & 3 \\ \hline
2 & HU6  & Como jugador, quiero ver un terreno en 3D del nivel a jugar. & M & 4 \\ \hline
2 & HU7  & Como jugador, quiero poder rotar la cámara para observar el terreno desde distintos ángulos. & S & 1 \\ \hline
2 & HU8  & Como jugador, quiero poder activar una capa de vista topográfica para entender el relieve. & C & 5 \\ \hline
3 & HU10 & Como jugador, quiero poder construir un tramo de vía férrea entre dos puntos. & M & 2 \\ \hline
3 & HU11 & Como jugador, quiero poder eliminar un tramo de vía férrea para rediseñar mis rutas. & M & 1 \\ \hline
3 & HU12 & Como jugador, quiero que se construyan puentes automáticamente al cruzar valles. & M & 4 \\ \hline
3 & HU13 & Como jugador, quiero que se construya automáticamente un túnel si mi vía férrea atraviesa una montaña. & M & 4 \\ \hline
3 & HU14 & Como jugador, quiero poder construir estaciones para definir los puntos de inicio y fin. & M & 3 \\ \hline
3 & HU15 & Como jugador, quiero ver mi presupuesto actual en todo momento. & M & 2 \\ \hline
3 & HU16 & Como jugador, quiero poder deshacer mi última acción de construcción. & S & 2 \\ \hline
4 & HU17 & Como jugador, quiero acceder a un menú para seleccionar y comprar la locomotora. & M & 3 \\ \hline
4 & HU18 & Como jugador, quiero añadir vagones específicos (pasajeros, carga) a mi locomotora. & M & 2 \\ \hline
4 & HU19 & Como jugador, quiero que el menú me muestre solo las locomotoras aptas para la ruta diseñada. & C & 2 \\ \hline
5 & HU20 & Como jugador, quiero ver una alerta visual cuando el tren sufre daños en zonas de evento. & M & 2 \\ \hline
5 & HU21 & Como jugador, quiero que el botón de "Testeo" me informe si falta algún requisito. & S & 3 \\ \hline
5 & HU22 & Como jugador, quiero volver a la construcción después de un testeo para corregir la ruta. & S & 1 \\ \hline
6 & HU23 & Como jugador, al finalizar un nivel, quiero ver una pantalla de puntuación. & M & 3 \\ \hline
6 & HU24 & Como jugador, quiero que la puntuación considere la rentabilidad (costo vs. contrato) y durabilidad. & M & 3 \\ \hline
6 & HU25 & Como jugador, quiero que la puntuación considere la eficiencia (tiempo empleado). & S & 3 \\ \hline
6 & HU26 & Como jugador, quiero ver un informe detallado que desglose mi puntuación final. & S & 3 \\ \hline
7 & HU27 & Como jugador, quiero desbloquear nuevos niveles tras completar el contrato actual. & M & 2 \\ \hline
8 & HU28 & Como jugador, quiero que Don Raíl presente el contrato con un diálogo breve y contexto histórico. & S & 3 \\ \hline
8 & HU29 & Como nuevo jugador, quiero que Don Raíl me guíe con un tutorial interactivo en el primer nivel. & S & 4 \\ \hline
8 & HU30 & Como jugador, quiero recibir advertencias contextuales sobre pendientes pronunciadas. & S & 4 \\ \hline
8 & HU31 & Como jugador, quiero ver datos históricos al seleccionar una ciudad importante. & S & 4 \\ \hline
8 & HU32 & Como jugador, quiero comentarios de Don Raíl cuando el tren sufre un evento. & S & 3 \\ \hline
8 & HU33 & Como jugador, quiero que Don Raíl comente mi puntuación final (éxito o consejo). & S & 2 \\ \hline
8 & HU34 & Como jugador, quiero ver anécdotas ferroviarias en las pantallas de carga. & M & 2 \\ \hline
6 & HU35 & Como administrador, quiero guardar metadatos de los jugadores en una base de datos. & M & 3 \\ \hline

\end{longtable}
\end{landscape}

\section{Diseño}

El diseño de la arquitectura de software se fundamentó en la creación de un prototipo funcional mínimo viable. El objetivo principal de esta etapa no consistió en maximizar los aspectos lúdicos o de entretenimiento inmediato, sino en establecer una base técnica robusta, modular y escalable que cumpla con los lineamientos del marco GBL (Game-Based Learning). Esta estructura busca garantizar que el sistema pueda operar correctamente bajo las reglas de simulación ferroviaria y permitir futuras expansiones o mejoras en las mecánicas educativas sin comprometer la estabilidad del software.

\subsection{Arquitectura de Escenas en Unity}

Para optimizar el uso de memoria y organizar lógicamente los componentes del videojuego, se optó por una arquitectura basada en escenas aditivas. En lugar de cargar un entorno monolítico único, el sistema gestiona la carga y descarga de escenas de manera superpuesta. Esto permite separar la lógica de la interfaz de usuario, el entorno geográfico pesado y las mecánicas específicas de cada nivel. En la Figura \ref{fig:escenas_aditivas} se ejemplifica este diseño.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{figures/escenas_aditivas.png}
\caption{Diagrama de la arquitectura basada en escenas aditivas.}
\label{fig:escenas_aditivas}
\end{figure}

El flujo de ejecución comienza con la carga simultánea de las escenas \textit{MainMenu} y \textit{MapaMenu}. Posteriormente, al iniciar la partida, se descarga la escena decorativa y se carga la escena \textit{MapaCompleto} junto con la escena del nivel correspondiente (por ejemplo, \textit{Nivel 1 Tutorial}), manteniendo siempre activa la escena base de gestión.

A continuación, se describen las 8 escenas que componen el videojuego serio dentro de Unity:

\begin{description}
    \item[MainMenu:] Es la escena persistente que contiene el lienzo (\textit{Canvas}) principal de la interfaz y los gestores globales del sistema. Los objetos instanciados aquí están configurados para no destruirse entre cargas (\textit{DontDestroyOnLoad}), asegurando la continuidad de la música, los datos del jugador y la gestión de estados.
    
    \item[MapaMenu:] Funciona como una escena puramente decorativa para el fondo del menú principal. Consiste en un fragmento extraído del mapa completo (exactamente 1 \textit{tile} de terreno) en el cual se ejecutan animaciones de trenes en bucle, brindando contexto visual sin cargar la totalidad de la geografía.
    
    \item[MapaCompleto:] Es la escena más compleja y pesada del sistema, encargada de contener la totalidad de la representación geográfica. Esta escena incluye:
    \begin{itemize}
        \item La malla del terreno dividida en una cuadrícula de $16 \times 16$ \textit{tiles} de Unity.
        \item La red hidrográfica completa, compuesta por 9972 objetos de ríos lineales (\textit{agua\_lineal}) y 40899 cuerpos de agua anchos o lagos (\textit{agua\_area}).
        \item Las delimitaciones políticas, incluyendo fronteras nacionales, departamentales y municipales.
        \item El etiquetado geográfico de todos los municipios de Colombia, posicionados sobre el terreno.
    \end{itemize}
    Cabe mencionar que, como decisión de diseño para la implementación, este mapa se construyó a una escala de 1:128 (1 unidad de Unity equivale a 128 metros reales) para equilibrar la precisión con el rendimiento.
    
    \item[Niveles (1 al 5):] Corresponden a 5 escenas independientes (\textit{Nivel 1 Tutorial}, \textit{Nivel 2}, etc.) que se cargan de forma aditiva sobre el mapa completo. Estas escenas contienen únicamente los objetos necesarios para la jugabilidad específica de ese contrato: los puntos de inicio y fin, la configuración de las mecánicas, los gestores de eventos locales y los \textit{Canvas} específicos de la misión.
\end{description}

\subsection{Diagrama de Componentes}

Dada la complejidad del sistema y su división en múltiples escenas, el diseño detallado de los scripts y sus interacciones se presenta mediante un diagrama de componentes. Debido a su extensión, este diagrama se ha visualizado de manera apaisada para facilitar la lectura de los módulos correspondientes a la gestión del mapa, la simulación del tren y la interfaz de usuario. Más adelante se detallará cada escena y sus componentes principales.

\begin{landscape}
\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{figures/test_DiagramaComponentes.png}
\caption{Diagrama de componentes del sistema organizado por escenas de Unity.}
\label{fig:diagrama_componentes}
\end{figure}
\end{landscape}

\subsection{Arquitectura del Sistema y API de Informes}

Dado que uno de los requisitos del juego para considerarse GBL es evaluar el aprendizaje y comportamiento de los jugadores, se implementó una arquitectura Cliente-Servidor. El cliente (el videojuego desarrollado en Unity) se comunica con un servidor backend encargado de procesar y almacenar la telemetría de las sesiones.

La Figura \ref{fig:arquitectura_api} ilustra el flujo de información:

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{figures/diseño_preliminar.png} 
\caption{Arquitectura del sistema e integración con la API de informes.}
\label{fig:arquitectura_api}
\end{figure}

\begin{enumerate}
    \item \textbf{Cliente Unity (C\#):} Al finalizar un nivel, el cliente recopila métricas clave (tiempo, presupuesto usado, daños, puntuación) y empaqueta estos datos en un objeto JSON.
    \item \textbf{API REST:} Se desarrolló una API intermedia que recibe las peticiones POST provenientes del videojuego. Esta API valida la integridad de los datos y gestiona la seguridad de las transacciones.
    \item \textbf{Base de Datos:} Los registros se almacenan en una base de datos No-SQL (FireBase), permitiendo la persistencia histórica de los intentos de los jugadores.
    \item \textbf{Módulo de Generación de Informes:} Un servicio independiente consulta la base de datos para generar visualizaciones estadísticas y reportes de rendimiento, los cuales son utilizados para la evaluación pedagógica presentada más adelante en este capítulo.
\end{enumerate}

La razón en usar una base de datos No-SQL vs SQL se debe a la naturaleza de la arquitectura de datos en el desarrollo de un videojuego; durante sus ciclos de vida un videojuego a comparación de otros productos software, sufren muchos cambios a nivel de estructura de datos. Por ejemplo, grandes empresas de videojuegos como \textit{RiotGames} o \textit{Electronics Arts} hoy en día utilizan DynamoDB, una base de datos No-SQL para sus videojuegos \autocite{AmazonDynamoDB}.
\section{Implementación y Desarrollo}
La fase de implementación se llevó a cabo utilizando el motor Unity (versión 6.0), haciendo uso de Git para el control de versiones y LFS para la gestión de activos pesados. A continuación, se detalla el proceso técnico de construcción del entorno y las mecánicas ferroviarias.

\subsection{Configuración del Espacio de Trabajo en Unity}

Para el desarrollo del proyecto se configuró un entorno de trabajo optimizado en Unity 6.0, diseñado para gestionar la complejidad del mapa de Colombia y la lógica de los sistemas ferroviarios. En la Figura \ref{fig:interfaz_unity} se observa la disposición de las herramientas y la interacción entre las ventanas del editor:

\begin{enumerate}
    \item \textbf{Jerarquía (Hierarchy):} En esta sección se evidencia el uso de un flujo de trabajo basado en múltiples escenas cargadas simultáneamente (\textit{Multi-Scene Editing}), como \textit{MapaCompleto}, \textit{Nivel 1} y \textit{Nivel 2}. Cada escena agrupa sus propios componentes y lógica de forma independiente. En este caso, se encuentra desplegado el \textit{Nivel 2}, donde se ha seleccionado el objeto \textit{Locomotora}, permitiendo una edición focalizada sin alterar el resto del entorno global.
    
    \item \textbf{Vista de Escena y Juego (Scene \& Game View):} El área central permite alternar entre la edición y la visualización final. La pestaña activa (\textit{Scene}) muestra el espacio tridimensional donde se realiza el ensamblaje del relieve y la ubicación de objetos. Adyacente a esta, se encuentra la pestaña \textit{Game}, la cual permite previsualizar la cámara del jugador y la interfaz de usuario final para realizar pruebas de ejecución inmediatas.
    
    \item \textbf{Inspector:} Esta ventana actúa de forma reactiva a la selección realizada en la Jerarquía. Al estar señalada la \textit{Locomotora}, el Inspector despliega todos los componentes asignados a dicho objeto. Desde aquí se gestionan propiedades como el \textit{Transform}, el sistema de audio y las variables físicas del motor del tren, permitiendo ajustar el comportamiento del vehículo en tiempo real.
    
    \item \textbf{Explorador de Proyecto (Project Window):} Contiene la biblioteca de archivos del juego organizada mediante una estructura de carpetas estandarizada (\textit{Meshes, Prefabs, Scripts, Settings}). Esta organización es fundamental para el control de versiones, asegurando que todos los activos del mapa de Colombia y los modelos ferroviarios estén correctamente indexados.
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth]{figures/interfaz_unity.jpeg}
\caption{Interfaz de desarrollo en Unity: 1) Jerarquía con edición multiescena, 2) Pestañas de Escena y Juego, 3) Inspector de componentes de la locomotora, 4) Gestión de activos.}
\label{fig:interfaz_unity}
\end{figure}

\subsection{Construcción del Entorno Geográfico}

El mapa de Colombia representa el tablero de juego principal. Su implementación pasó por múltiples iteraciones para equilibrar el realismo geográfico con el rendimiento técnico.

Inicialmente, se importó un modelo 3D de alta resolución generado en Blender a partir de mapas de elevación (DEM). Como se observa en la Figura \ref{fig:mapa_inicial}, aunque visualmente detallado, este enfoque resultó inviable debido a la carga de 24.5 millones de vértices, lo que redujo la tasa de refresco a menos de 26 FPS.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{figures/mapa_colombia_v1.jpeg}
\caption{Primer intento de generar el terreno usando un modelo 3D en Blender.}
\label{fig:mapa_inicial}
\end{figure}

Tras experimentar con versiones de baja cantidad de polígonos (\textit{low-poly}) y fragmentadas que no solucionaron los problemas de latancia en las llamadas de renderizado(\textit{draw-calls}), se optó por la solución de usar el sistema de terrenos nativo de Unity.\\

\subsubsection{Automatización y Procesamiento de Datos Geográficos}

Para la implementación definitiva, no se esculpió el terreno manualmente. En su lugar, se desarrolló un flujo de trabajo automatizado mediante \textit{scripts} en C\# que generaban la topografía a partir de datos reales.\\

Una herramienta fundamental en esta etapa fue el software QGIS ( Quantum Geographic Information System). Esta herramienta permitió procesar y alinear todas las capas de información —fronteras municipales, hidrografía (ríos y lagos) y elevación— bajo un Sistema de Referencia de Coordenadas unificado, específicamente el \textit{EPSG:9377} (MAGNA-SIRGAS Origen Nacional). Esto garantizó que todos los elementos geográficos mantuvieran su posición relativa correcta al ser importados al motor de videojuego. En la Figura \ref{fig:qgis_1} se muestra todos los datos recopilados y correctamente ubicados como son el mapa de alturas, los cuerpos de agua, las fronteras nacional, departamentales y municipales de Colombia.

\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth]{figures/qgis_obramaestra.png}
\caption{Captura de pantalla del proyecto en QGIS utilizado para el manejo de datos sobre el terreno.}
\label{fig:qgis_1}
\end{figure}

El Modelo Digital de Elevación (DEM) utilizado como base fue obtenido a través del \textit{General Bathymetric Chart of the Oceans} \autocite{GEBCO}. Dada la extensión del territorio, se decidió segmentar este DEM en una cuadrícula de $16 \times 16$ secciones, generando terrenos interconectados dentro de Unity a una escala de 1:128.

\subsubsection{Estrategia de Segmentación (Chunks)}

Esta división en 256 \textit{tiles} o baldosas respondía a una estrategia inicial de optimización basada en la carga dinámica de \textit{chunks}. En este contexto, un \textit{chunk} se definió como una unidad lógica compuesta por un fragmento de terreno y la totalidad de los objetos (etiquetas, cuerpos de agua, divisiones políticas) situados sobre él. La intención original era cargar y descargar estos bloques de memoria en tiempo real según la posición del jugador.

\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth]{figures/codigo_importador_terrenos.png}
\caption{Fragmento del código del script que automatizaba la importación de terrenos desde archivos .raw a la escena en Unity.}
\label{fig:cod_1}
\end{figure}

Sin embargo, durante las pruebas de integración, se observó que el rendimiento del sistema era estable incluso con la totalidad del mapa cargado en memoria. Por consiguiente, se descartó el sistema de carga dinámica para reducir la complejidad del código, aunque se mantuvo la estructura modular de $16 \times 16$ para trabajo a futuro.
\subsubsection{Texturizado y Restricciones de Construcción}

Finalmente, el terreno fue texturizado automáticamente aplicando un material autogenerado y semi-autocoloreado según la altura (mar, pasto, nieve). En la Figura \ref{fig:inspector_colores} se muestra el script desde la vista del inspector dentro del objeto \textit{Terreno\_Colombiav2} en donde se evidencia la interfaz hecha para manejar las capas por color y alturas.\\

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{figures/inspector_colores.png}
\caption{Captura de la clase \textit{HeighBandsPainter} desde el inspector.}
\label{fig:inspector_colores}
\end{figure}

La Figura \ref{fig:mapa_unity} muestra el resultado final del terreno implementado.

\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth]{figures/mapa_unity.jpeg}
\caption{Implementación final del entorno geográfico utilizando el sistema de Terrenos de Unity.}
\label{fig:mapa_unity}
\end{figure}

\subsection{Sistema Ferroviario y Físicas}

La mecánica central del juego es la construcción y simulación de trenes. Para evitar la rigidez de un sistema basado en tramos rectos, se implementó una solución basada en **Splines** (curvas matemáticas suaves).

Se utilizó el paquete \textit{Dreamteck Splines} como base matemática, sobre la cual se programó la lógica de negocio del juego:
\begin{enumerate}
    \item \textbf{Generación Procedimental:} Al trazar una ruta, el sistema instancia automáticamente durmientes, rieles y balasto adaptándose a la curvatura del spline.
    \item \textbf{Lógica de Túneles y Puentes:} Mediante *Raycasting*, el sistema detecta si la vía atraviesa una montaña o un abismo. Si detecta terreno por encima de la vía, reemplaza el modelo de vía estándar por un túnel; si no detecta terreno por debajo, instancia pilares para crear un puente.
    \item \textbf{Movimiento del Tren:} El tren no utiliza físicas de ruedas complejas (que son costosas computacionalmente), sino que se proyecta a lo largo del spline. Sin embargo, se simulan variables físicas como la inercia y la fricción. La velocidad se calcula en función de la pendiente:
    \begin{equation}
        Vel_{actual} = Vel_{motor} - (Inclinacion \times Factor_{carga} \times Num_{vagones})
    \end{equation}
    Esto obliga al jugador a pensar como ingeniero: si la pendiente es muy alta y el tren lleva mucha carga, la velocidad puede llegar a cero, impidiendo completar el nivel.
\end{enumerate}

Para la representación visual, se modelaron trenes propios (Figura \ref{fig:tren_modelo}) y se implementó un sistema de daño visual (explosiones y humo) que se activa cuando el tren pasa por zonas de riesgo a alta velocidad (Figura \ref{fig:trenExplota}).

\begin{figure}[H]
\centering
\begin{minipage}{0.45\textwidth}
    \centering
    \includegraphics[width=\linewidth]{figures/tren_modelo.jpeg}
    \caption{Modelado de locomotoras.}
    \label{fig:tren_modelo}
\end{minipage}\hfill
\begin{minipage}{0.45\textwidth}
    \centering
    \includegraphics[width=\linewidth]{figures/trenExplota.png}
    \caption{Sistema de partículas de daño.}
    \label{fig:trenExplota}
\end{minipage}
\end{figure}

\section{Pruebas y Análisis de Resultados}

Para validar la efectividad del prototipo como herramienta de aprendizaje y su calidad como software, se realizó una prueba piloto controlada.
La fase de pruebas tuvo una duración de \textbf{4 días}, contando con la participación voluntaria de \textbf{22} personas de la comunidad universitaria.

El proceso de recolección de datos fue híbrido:
\begin{itemize}
    \item \textbf{Cuantitativo:} Mediante la API de informes, que registró automáticamente las estadísticas de juego de cada sesión.
    \item \textbf{Cualitativo:} Mediante una encuesta de percepción aplicada al finalizar la experiencia.
\end{itemize}

\subsection{Análisis de Telemetría (Datos de la API)}

Gracias a la arquitectura implementada, se pudo analizar el desempeño real de los jugadores sin depender únicamente de su autopercepción. A continuación, se presentan los hallazgos basados en los datos almacenados en la base de datos.

\subsubsection{Tasas de Éxito y Fracaso por Nivel}
La Figura \ref{fig:grafica_exito} muestra el porcentaje de intentos exitosos frente a los fallidos en cada uno de los niveles.

\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{figures/grafica_tasa_exito.png} % AGREGAR TU GRAFICA AQUI
\framebox[0.8\textwidth]{\rule{0pt}{6cm} [INSERTAR GRÁFICA DE BARRAS: ÉXITO VS FRACASO]}
\caption{Tasa de completitud por nivel registrada por la API.}
\label{fig:grafica_exito}
\end{figure}

Se observa que los primeros niveles tienen una tasa de éxito superior al 90\%, lo que valida la curva de aprendizaje inicial. Sin embargo, en el Nivel [X] se evidencia un pico de fracasos, correlacionado con la introducción de la mecánica de gestión de presupuesto limitado.

\subsubsection{Eficiencia de Costos y Tiempo}
La Figura \ref{fig:grafica_dispersion} relaciona el tiempo empleado vs. el presupuesto gastado por los jugadores que completaron el juego.

\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{figures/grafica_dispersion.png} % AGREGAR TU GRAFICA AQUI
\framebox[0.8\textwidth]{\rule{0pt}{6cm} [INSERTAR GRÁFICA DE DISPERSIÓN: TIEMPO VS COSTO]}
\caption{Relación entre tiempo de ejecución y presupuesto utilizado.}
\label{fig:grafica_dispersion}
\end{figure}

Los datos sugieren que los jugadores tendieron a sacrificar presupuesto (construyendo túneles costosos) para minimizar el tiempo de viaje, priorizando la velocidad sobre la economía en un [XX]\% de los casos.

\subsection{Resultados de la Encuesta de Percepción}

Tras finalizar la prueba, los participantes evaluaron la usabilidad y el valor educativo del prototipo.

\subsubsection{Usabilidad y Experiencia de Usuario}
Se preguntó sobre la facilidad de uso de las herramientas de construcción. El [XX]\% de los encuestados calificó el sistema de splines como \textit{Intuitivo} o \textit{Muy Intuitivo}. Sin embargo, un [XX]\% reportó dificultades con la cámara en dispositivos con pantallas pequeñas.

\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{figures/grafica_encuesta_usabilidad.png} % AGREGAR TU GRAFICA AQUI
\framebox[0.8\textwidth]{\rule{0pt}{5cm} [INSERTAR GRÁFICA DE TORTA: CALIFICACIÓN USABILIDAD]}
\caption{Percepción de la usabilidad del sistema de construcción.}
\label{fig:encuesta_usabilidad}
\end{figure}

\subsubsection{Percepción del Aprendizaje (GBL)}
Respecto al componente educativo, la Figura \ref{fig:encuesta_aprendizaje} refleja la opinión de los estudiantes sobre la adquisición de conocimientos ferroviarios.

\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{figures/grafica_encuesta_aprendizaje.png} % AGREGAR TU GRAFICA AQUI
\framebox[0.8\textwidth]{\rule{0pt}{5cm} [INSERTAR GRÁFICA DE BARRAS: TEMAS APRENDIDOS]}
\caption{Temas sobre ingeniería ferroviaria que los usuarios consideran haber aprendido.}
\label{fig:encuesta_aprendizaje}
\end{figure}

Los participantes destacaron principalmente la comprensión de la relación entre la topografía (pendientes) y la capacidad de carga del tren, validando el objetivo pedagógico de la simulación física.

\section{Errores Detectados}
Durante la prueba piloto de 4 días, se reportaron los siguientes fallos que requieren corrección:
\begin{itemize}
    \item \textbf{Cámara en límites del mapa:} En ocasiones, la cámara permite visualizar el \textit{vacío} si el jugador se desplaza a los bordes extremos del mapa. Se requiere implementar límites rígidos (\textbf{clamping}) en las coordenadas de la cámara.
    \item \textbf{Colisiones fantasma:} En el 2\% de las partidas registradas por la API, el tren detectó daño sin haber una colisión visual clara. Esto sugiere la necesidad de refinar los \textbf{colliders} de las zonas de riesgo.
\end{itemize}